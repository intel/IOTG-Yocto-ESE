# this is the standard full sized image with LTS kernel as the default boot option
SELECTABLE_KERNEL_DEFAULT = "x86-lts-2020-kernel-default.inc"

# common contents and settings
require conf/include/ese-x86-image.inc

APPEND_append = "${@bb.utils.contains("LAYERSERIES_COMPAT_core","dunfell", " i915.enable_guc=2", "", d)}"
APPEND_append = "${@bb.utils.contains("LAYERSERIES_COMPAT_core","hardknott", " i915.enable_guc=7", "", d)}"

# SGX Dunfell
KERNEL_PROVIDERS_EXTRA_MODULES[5.10] += "${@bb.utils.contains("LAYERSERIES_COMPAT_core","dunfell", "isgx", "", d)}"
IMAGE_INSTALL_append = "${@bb.utils.contains("LAYERSERIES_COMPAT_core","dunfell", " sgx isgx-blacklist", "", d)}"
RECOMMENDS_sgx_remove = "${@bb.utils.contains("LAYERSERIES_COMPAT_core","dunfell", " kernel-modules-sgx", "", d)}"

# SGX Hardknott
KERNEL_PROVIDERS_EXTRA_MODULES[5.10] += "${@bb.utils.contains("LAYERSERIES_COMPAT_core","hardknott", "intelsgx", "", d)}"
IMAGE_INSTALL_append = "${@bb.utils.contains("LAYERSERIES_COMPAT_core","hardknott", " sgx sgx-dcap", "", d)}"

# UAPI patches
require conf/include/uapi-ptp-patches.inc
